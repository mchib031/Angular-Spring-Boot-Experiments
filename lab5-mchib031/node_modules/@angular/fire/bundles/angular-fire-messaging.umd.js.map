{"version":3,"file":"angular-fire-messaging.umd.js","sources":["../../../src/messaging/messaging.ts","../../../src/messaging/messaging.module.ts","../../../src/messaging/firebase.ts","../../../src/messaging/angular-fire-messaging.ts"],"sourcesContent":["import { Messaging as FirebaseMessaging } from 'firebase/messaging';\nimport { ɵgetAllInstancesOf } from '@angular/fire';\nimport { from, timer } from 'rxjs';\nimport { concatMap, distinct } from 'rxjs/operators';\n\n// see notes in core/firebase.app.module.ts for why we're building the class like this\n// tslint:disable-next-line:no-empty-interface\nexport interface Messaging extends FirebaseMessaging {}\n\nexport class Messaging {\n  constructor(messaging: FirebaseMessaging) {\n    return messaging;\n  }\n}\n\nexport const MESSAGING_PROVIDER_NAME = 'messaging';\n\n// tslint:disable-next-line:no-empty-interface\nexport interface MessagingInstances extends Array<FirebaseMessaging> {}\n\nexport class MessagingInstances {\n  constructor() {\n    return ɵgetAllInstancesOf<FirebaseMessaging>(MESSAGING_PROVIDER_NAME);\n  }\n}\n\nexport const messagingInstance$ = timer(0, 300).pipe(\n  concatMap(() => from(ɵgetAllInstancesOf<FirebaseMessaging>(MESSAGING_PROVIDER_NAME))),\n  distinct(),\n);\n","import { NgModule, Optional, NgZone, InjectionToken, ModuleWithProviders, APP_INITIALIZER } from '@angular/core';\nimport { isSupported, Messaging as FirebaseMessaging } from 'firebase/messaging';\nimport { ɵgetDefaultInstanceOf, ɵmemoizeInstance, ɵAngularFireSchedulers, VERSION } from '@angular/fire';\nimport { Messaging, MessagingInstances, MESSAGING_PROVIDER_NAME } from './messaging';\nimport { FirebaseApps, FirebaseApp } from '@angular/fire/app';\nimport { registerVersion } from 'firebase/app';\n\nconst PROVIDED_MESSAGING_INSTANCES = new InjectionToken<Messaging[]>('angularfire2.messaging-instances');\nconst IS_SUPPORTED = new InjectionToken<boolean>('angularfire2.messaging.isSupported');\n\nconst isSupportedSymbol = Symbol('angularfire2.messaging.isSupported');\n\nexport function defaultMessagingInstanceFactory(isSupported: boolean, provided: FirebaseMessaging[]|undefined, defaultApp: FirebaseApp) {\n  const defaultAuth = isSupported ?\n    ɵgetDefaultInstanceOf<FirebaseMessaging>(MESSAGING_PROVIDER_NAME, provided, defaultApp) :\n    undefined;\n  return new Messaging(defaultAuth);\n}\n\nexport function messagingInstanceFactory(fn: () => FirebaseMessaging) {\n  return (zone: NgZone, isSupported: boolean) => {\n    const messaging = isSupported ? ɵmemoizeInstance<FirebaseMessaging>(fn, zone) : undefined;\n    return new Messaging(messaging);\n  };\n}\n\nconst MESSAGING_INSTANCES_PROVIDER = {\n  provide: MessagingInstances,\n  deps: [\n    [new Optional(), PROVIDED_MESSAGING_INSTANCES ],\n  ]\n};\n\nconst DEFAULT_MESSAGING_INSTANCE_PROVIDER = {\n  provide: Messaging,\n  useFactory: defaultMessagingInstanceFactory,\n  deps: [\n    IS_SUPPORTED,\n    [new Optional(), PROVIDED_MESSAGING_INSTANCES ],\n    FirebaseApp,\n  ]\n};\n\n@NgModule({\n  providers: [\n    DEFAULT_MESSAGING_INSTANCE_PROVIDER,\n    MESSAGING_INSTANCES_PROVIDER,\n    {\n      provide: APP_INITIALIZER,\n      useValue: () => isSupported().then(it => globalThis[isSupportedSymbol] = it),\n      multi: true,\n    },\n  ]\n})\nexport class MessagingModule {\n  constructor() {\n    registerVersion('angularfire', VERSION.full, 'fcm');\n  }\n}\n\nexport function provideMessaging(fn: () => FirebaseMessaging): ModuleWithProviders<MessagingModule> {\n  return {\n    ngModule: MessagingModule,\n    providers: [{\n      provide: IS_SUPPORTED,\n      useFactory: () => globalThis[isSupportedSymbol],\n    }, {\n      provide: PROVIDED_MESSAGING_INSTANCES,\n      useFactory: messagingInstanceFactory(fn),\n      multi: true,\n      deps: [\n        NgZone,\n        IS_SUPPORTED,\n        ɵAngularFireSchedulers,\n        FirebaseApps,\n      ],\n    }]\n  };\n}\n","// DO NOT MODIFY, this file is autogenerated by tools/build.ts\nexport * from 'firebase/messaging';\nimport { ɵzoneWrap } from '@angular/fire';\nimport {\n  deleteToken as _deleteToken,\n  getMessaging as _getMessaging,\n  getToken as _getToken,\n  isSupported as _isSupported,\n  onMessage as _onMessage\n} from 'firebase/messaging';\n\nexport const deleteToken = ɵzoneWrap(_deleteToken, true);\nexport const getMessaging = ɵzoneWrap(_getMessaging, true);\nexport const getToken = ɵzoneWrap(_getToken, true);\nexport const isSupported = ɵzoneWrap(_isSupported, true);\nexport const onMessage = ɵzoneWrap(_onMessage, false);\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["ɵgetAllInstancesOf","timer","concatMap","from","distinct","InjectionToken","ɵgetDefaultInstanceOf","ɵmemoizeInstance","Optional","FirebaseApp","registerVersion","VERSION","APP_INITIALIZER","isSupported","NgModule","NgZone","ɵAngularFireSchedulers","FirebaseApps","ɵzoneWrap","_deleteToken","_getMessaging","_getToken","_isSupported","_onMessage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAUE,mBAAY,SAA4B;YACtC,OAAO,SAAS,CAAC;SAClB;wBACF;KAAA,IAAA;IAEM,IAAM,uBAAuB,GAAG,WAAW,CAAC;;QAMjD;YACE,OAAOA,uBAAkB,CAAoB,uBAAuB,CAAC,CAAC;SACvE;iCACF;KAAA,IAAA;QAEY,kBAAkB,GAAGC,UAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,IAAI,CAClDC,mBAAS,CAAC,cAAM,OAAAC,SAAI,CAACH,uBAAkB,CAAoB,uBAAuB,CAAC,CAAC,GAAA,CAAC,EACrFI,kBAAQ,EAAE;;ICrBZ,IAAM,4BAA4B,GAAG,IAAIC,iBAAc,CAAc,kCAAkC,CAAC,CAAC;IACzG,IAAM,YAAY,GAAG,IAAIA,iBAAc,CAAU,oCAAoC,CAAC,CAAC;IAEvF,IAAM,iBAAiB,GAAG,MAAM,CAAC,oCAAoC,CAAC,CAAC;aAEvD,+BAA+B,CAAC,WAAoB,EAAE,QAAuC,EAAE,UAAuB;QACpI,IAAM,WAAW,GAAG,WAAW;YAC7BC,0BAAqB,CAAoB,uBAAuB,EAAE,QAAQ,EAAE,UAAU,CAAC;YACvF,SAAS,CAAC;QACZ,OAAO,IAAI,SAAS,CAAC,WAAW,CAAC,CAAC;IACpC,CAAC;aAEe,wBAAwB,CAAC,EAA2B;QAClE,OAAO,UAAC,IAAY,EAAE,WAAoB;YACxC,IAAM,SAAS,GAAG,WAAW,GAAGC,qBAAgB,CAAoB,EAAE,EAAE,IAAI,CAAC,GAAG,SAAS,CAAC;YAC1F,OAAO,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC;SACjC,CAAC;IACJ,CAAC;IAED,IAAM,4BAA4B,GAAG;QACnC,OAAO,EAAE,kBAAkB;QAC3B,IAAI,EAAE;YACJ,CAAC,IAAIC,WAAQ,EAAE,EAAE,4BAA4B,CAAE;SAChD;KACF,CAAC;IAEF,IAAM,mCAAmC,GAAG;QAC1C,OAAO,EAAE,SAAS;QAClB,UAAU,EAAE,+BAA+B;QAC3C,IAAI,EAAE;YACJ,YAAY;YACZ,CAAC,IAAIA,WAAQ,EAAE,EAAE,4BAA4B,CAAE;YAC/CC,eAAW;SACZ;KACF,CAAC;;QAcA;YACEC,qBAAe,CAAC,aAAa,EAAEC,YAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SACrD;;;sIAHU,eAAe;uIAAf,eAAe;uIAAf,eAAe,aAVf;YACT,mCAAmC;YACnC,4BAA4B;YAC5B;gBACE,OAAO,EAAEC,kBAAe;gBACxB,QAAQ,EAAE,cAAM,OAAAC,qBAAW,EAAE,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,UAAU,CAAC,iBAAiB,CAAC,GAAG,EAAE,GAAA,CAAC,GAAA;gBAC5E,KAAK,EAAE,IAAI;aACZ;SACF;qHAEU,eAAe;sBAX3BC,WAAQ;uBAAC;wBACR,SAAS,EAAE;4BACT,mCAAmC;4BACnC,4BAA4B;4BAC5B;gCACE,OAAO,EAAEF,kBAAe;gCACxB,QAAQ,EAAE,cAAM,OAAAC,qBAAW,EAAE,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,UAAU,CAAC,iBAAiB,CAAC,GAAG,EAAE,GAAA,CAAC,GAAA;gCAC5E,KAAK,EAAE,IAAI;6BACZ;yBACF;qBACF;;aAOe,gBAAgB,CAAC,EAA2B;QAC1D,OAAO;YACL,QAAQ,EAAE,eAAe;YACzB,SAAS,EAAE,CAAC;oBACV,OAAO,EAAE,YAAY;oBACrB,UAAU,EAAE,cAAM,OAAA,UAAU,CAAC,iBAAiB,CAAC,GAAA;iBAChD,EAAE;oBACD,OAAO,EAAE,4BAA4B;oBACrC,UAAU,EAAE,wBAAwB,CAAC,EAAE,CAAC;oBACxC,KAAK,EAAE,IAAI;oBACX,IAAI,EAAE;wBACJE,SAAM;wBACN,YAAY;wBACZC,2BAAsB;wBACtBC,gBAAY;qBACb;iBACF,CAAC;SACH,CAAC;IACJ;;IC9EA;QAWa,WAAW,GAAGC,cAAS,CAACC,qBAAY,EAAE,IAAI,EAAE;QAC5C,YAAY,GAAGD,cAAS,CAACE,sBAAa,EAAE,IAAI,EAAE;QAC9C,QAAQ,GAAGF,cAAS,CAACG,kBAAS,EAAE,IAAI,EAAE;QACtC,WAAW,GAAGH,cAAS,CAACI,qBAAY,EAAE,IAAI,EAAE;QAC5C,SAAS,GAAGJ,cAAS,CAACK,mBAAU,EAAE,KAAK;;ICfpD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}